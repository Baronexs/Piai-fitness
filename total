backup index.php
<?php
require 'function.php';
?>

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Dashboard - Piai Fitnes</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js" crossorigin="anonymous"></script>
    <body>
        
    </body>
    
    </head>
    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <a class="navbar-brand" href="index.php">Piai Fitnes</a>
            <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i></button>
            <!-- Navbar-->
        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <a class="nav-link" href="index.php">
                                <div class="sb-nav-link-icon"><i class="fa fa-credit-card"></i></div>
                                Transaksi
                            </a>
                            <a class="nav-link" href="customer.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-address-card"></i></div>
                                Pelanggan
                            </a>
                            <a class="nav-link" href="pelatih.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Pelatih
                            </a>
                            <a class="nav-link" href="personaltrainer.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-dumbbell"></i></div>
                                Personal Trainer
                            </a>
                            <a class="nav-link" href="karyawan.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-child"></i></div>
                                Karyawan 
                            </a>
                            <a class="nav-link" href="login.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-toggle-off"></i></div>
                                logout
                            </a>
                        </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">
                        <h1 class="mt-4">Transaksi</h1> 
                            <div class="card-header">
                                <!-- Button to Open the Modal -->
                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                                Tambah Transaksi
                                </button>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                            <thead>
                                            <tr>
                                                <th>No</th>
                                                <th>Tanggal Masuk</th>
                                                <th>id customer</th>
                                                <th>id karyawan</th>
                                                <th>Option</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <?php
                                            $i = 1; 
                                            $ambilsemuadatatransaksi = mysqli_query($conn, "SELECT * FROM transaksi INNER JOIN customer ON transaksi.idcustomer = customer.idcustomer");
                                            while ($data = mysqli_fetch_array($ambilsemuadatatransaksi)) {
                                                $idi = $data['id_invoice']; // Primary key
                                                $tanggal = $data['tanggal'];
                                                $idcustomer = $data['idcustomer'];
                                                $idkaryawan = $data['idkaryawan'];
                                                $pelanggan = $data['pelanggan'];
                                                $nohp = $data['nohp'];
                                                $alamat = $data['alamat'];
                                                $idperiode = $data['idperiode'];
                                                $jumlah = $data['jumlah'];
                                                $idpelatih = $data['idpelatih'];

                                                // Ambil harga personal trainer per bulan
                                                $result_trainer = mysqli_query($conn, "SELECT hargatrainer FROM pelatih WHERE idpelatih = '$idpelatih'");
                                                if ($result_trainer) {
                                                    $row_trainer = mysqli_fetch_assoc($result_trainer);
                                                    if ($row_trainer) {
                                                        $hargatrainer_perbulan = $row_trainer['hargatrainer'];
                                                    }
                                                }                                           
                                                if ($idperiode === 'Bulanan') { 
                                                    $result_periode = mysqli_query($conn, "SELECT hargaperiode FROM periode WHERE periode = 'Bulanan'");
                                                    if ($result_periode) {
                                                        $row_periode = mysqli_fetch_assoc($result_periode);
                                                        if ($row_periode) {
                                                            $hargaperiode_perbulan = $row_periode['hargaperiode'];
                                                        }
                                                    }
                                                }
                                                
                                                $total_biaya_trainer = $hargatrainer_perbulan * $jumlah;
                                                $total_biaya_periode = $hargaperiode_perbulan * $jumlah;
                                                $total_cost = $total_biaya_trainer + $total_biaya_periode;
                                            
                                                ?>      
                                                <tr>
                                                    <td><?php echo $i++; ?></td>
                                                    <td><?php echo $tanggal; ?></td>
                                                    <td><?php echo $idcustomer; ?></td> 
                                                    <td><?php echo $idkaryawan; ?></td>
                                                    <td>
                                                        <button type="button" class="btn btn-info" data-toggle="modal" data-target="#view<?php echo $idi; ?>">
                                                            View
                                                        </button>
                                                        <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete<?php echo $idi; ?>">
                                                            Delete
                                                        </button>
                                                    </td>
                                                </tr>
                                                <!-- View Modal -->
                                                <div class="modal" id="view<?php echo $idi; ?>">
                                                    <div class="modal-dialog modal-x">
                                                        <div class="modal-content">
                                                            <!-- Modal Header -->
                                                            <div class="modal-header">
                                                                <h4 class="modal-title">Detail Transaksi</h4>                  
                                                                <button type="button" class="close" data-dismiss="modal"></button>
                                                            </div>
                                                            <!-- Modal body -->
                                                            <div class="modal-body">
                                                                <div class="row">
                                                                    <div class="col-sm-4">
                                                                        Nama Pelanggan  :   <br/>
                                                                        No Hp           :   <br/>
                                                                        Alamat          :   <br/>
                                                                        Id Periode      :   <br/>
                                                                        Jumlah          :   <br/>
                                                                        Id Trainer      :   <br/>
                                                                        Total Harga      :   <br/>
                                                                    </div>
                                                                    <div class="col-sm-8">   
                                                                        <b><?php echo $pelanggan; ?></b><br/>
                                                                        <b><?php echo $nohp; ?></b><br/>
                                                                        <b><?php echo $alamat; ?></b><br/>
                                                                        <b><?php echo $idperiode; ?></b><br/>
                                                                        <b><?php echo $jumlah; ?></b><br/>
                                                                        <b><?php echo $idpelatih; ?></b><br/>
                                                                        <b><?php echo number_format($total_cost, 0, ',', '.'); ?></b><br/>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            <div class="modal-footer display">
                                                                <div class="row">
                                                                    <div class="col-md-12">
                                                                        <button class="btn float-right btn-secondary" type="button" data-dismiss="modal">Close</button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- Modal untuk Delete -->
                                                <div class="modal" id="delete<?php echo $idi; ?>">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <!-- Modal Header -->
                                                            <div class="modal-header">
                                                                <h4 class="modal-title">Hapus Transaksi</h4>
                                                                <button type="button" class="close" data-dismiss="modal"></button>
                                                            </div>
                                                            <!-- Modal body -->
                                                            <form method="post">
                                                                <div class="modal-body">
                                                                    Apakah Anda yakin ingin menghapus Transaksi ini?
                                                                    <input type="hidden" name="id_invoice" value="<?php echo $idi; ?>">
                                                                    <br><br>
                                                                    <button type="submit" class="btn btn-danger" name="hapustransaksi">Hapus</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            <?php
                                            }
                                            ?>
                                            </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </main>
                    </div>
                </div>
                <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
                <script src="js/scripts.js"></script>
                <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
                <script src="assets/demo/chart-area-demo.js"></script>
                <script src="assets/demo/chart-bar-demo.js"></script>
                <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
                <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
                <script src="assets/demo/datatables-demo.js"></script>
            </body>

                <!-- The Modal -->
            <div class="modal" id="myModal">
                <div class="modal-dialog">
                <div class="modal-content">

                    <!-- Modal Header -->
                    <div class="modal-header">
                    <h4 class="modal-title">Tambah Transaksi</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    </div>

                <!-- Modal body -->
                <form method="post">
                    <div class="modal-body">
                    <br>
                    <select name="customernya" class="form-control">
                <?php
                    $tuliscustomernya = mysqli_query($conn, "select * from customer");                    
                    while($fetcharray = mysqli_fetch_array($tuliscustomernya)) {
                    $idc = $fetcharray['idcustomer'];
                    $pelanggan = $fetcharray['pelanggan'];

                ?>
                    <option value="<?= $idc; ?>"><?= $pelanggan; ?></option>
                    <?php
                    }
                    ?>
                    </select>
                    <br>
                    <select name="karyawannya" class="form-control">
                <?php
                    $tuliskaryawannya = mysqli_query($conn, "select * from karyawan");
                    while($fetcharray = mysqli_fetch_array($tuliskaryawannya)) {
                    $idkaryawan = $fetcharray['idkaryawan'];
                    $namakaryawan = $fetcharray['namakaryawan'];
                ?>
                <option value="<?= $idkaryawan; ?>"><?= $namakaryawan; ?></option>
                <?php
                }
                ?>
                </select>
                <br>
                <button type="submit" class="btn btn-primary" name="addnewtransaksi">submit</button>
                </div>
                <br>
                </div>
                </div>   
            </div>
        </html>

        backup customer.php

        <?php
require 'function.php';
?>

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
        <meta name="description" content="" />
        <meta name="author" content="" />
        <title>Dashboard - Piai Fitnes</title>
        <link href="css/styles.css" rel="stylesheet" />
        <link href="https://cdn.datatables.net/1.10.20/css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/js/all.min.js" crossorigin="anonymous"></script>
    </head>
    <body class="sb-nav-fixed">
        <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
            <a class="navbar-brand" href="index.php">Piai Fitnes</a>
            <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i class="fas fa-bars"></i></button>

        </nav>
        <div id="layoutSidenav">
            <div id="layoutSidenav_nav">
                <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                    <div class="sb-sidenav-menu">
                        <div class="nav">
                            <a class="nav-link" href="index.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Transaksi
                            </a>
                            <a class="nav-link" href="customer.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Pelanggan
                            </a>
                            <a class="nav-link" href="pelatih.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Pelatih
                            </a>
                            <a class="nav-link" href="personaltrainer.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Personal Trainer
                            </a>
                            <a class="nav-link" href="karyawan.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                Karyawan 
                            </a>
                            <a class="nav-link" href="login.php">
                                <div class="sb-nav-link-icon"><i class="fas fa-tachometer-alt"></i></div>
                                logout
                            </a>
                        </div>
                </nav>
            </div>
            <div id="layoutSidenav_content">
                <main>
                    <div class="container-fluid">
                        <h1 class="mt-4">Pelanggan</h1> 
                            <div class="card-header">
                                 <!-- Button to Open the Modal -->
                            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal">
                                Tambah Pelanggan
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
                                        <thead>
                                            <tr>
                                                <th>id pelanggan</th>
                                                <th>Nama Pelanggan</th>
                                                <th>No.HP</th>
                                                <th>Alamat</th>
                                                <th>Option</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        <?php
                                            $ambilsemuadatacustomer = mysqli_query($conn, "select * from customer");
                                            while ($data = mysqli_fetch_array($ambilsemuadatacustomer)) {
                                                $idc = $data['idcustomer'];
                                                $pelanggan = $data['pelanggan'];
                                                $nohp = $data['nohp'];
                                                $alamat = $data['alamat'];
                                                $idperiode = $data['idperiode'];
                                                $jumlah = $data['jumlah'];
                                                $idpelatih = $data['idpelatih'];



                                            ?>
                                            <tr>
                                                <td><?php echo $idc; ?></td>
                                                <td><?php echo $pelanggan; ?></td>
                                                <td><?php echo $nohp; ?></td>
                                                <td><?php echo $alamat; ?></td>



                                                <td>
                                                <button type="button" class="btn btn-info" data-toggle="modal" data-target="#edit<?php echo $idc; ?>">
                                                Edit
                                                </button>
                                                <input type="hidden" name="editcustomeryangmaudihapus" value="<?php echo $idc; ?>">
                                                    <!-- Perbaikan: Pastikan 'data-target' mengarah ke modal yang benar -->
                                                    <button type="button" class="btn btn-danger" data-toggle="modal" data-target="#delete<?php echo $idc; ?>">
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                            <!-- Modal Edit -->
                                            <div class="modal" id="edit<?php echo $idc; ?>">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">

                                                        <!-- Modal Header -->
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Edit Pelanggan</h4>
                                                            <button type="button" class="close" data-dismiss="modal"></button>
                                                        </div>
                                                        <!-- Modal body -->
                                                        <form method="post">
                                                            <div class="modal-body">
                                                                <input type="hidden" name="idcustomer" value="<?php echo $idc; ?>">
                                                                <input type="text" name="pelanggan" value="<?php echo $pelanggan ?? ''; ?>" class="form-control" required>
                                                                <br>
                                                                <input type="text" name="nohp" value="<?php echo $nohp ?? ''; ?>" class="form-control" required>
                                                                <br>
                                                                <input type="text" name="alamat" value="<?php echo $alamat ?? ''; ?>" class="form-control" required>
                                                                <br>
                                                                <input type="hidden" name="id_invoice" value="<?php echo $idc ?? ''; ?>">
                                                                <input name="idperiode" class="form-control" value="Bulanan" readonly>
                                                                </select>
                                                                <br>
                                                                <input type="text" name="jumlah" value="<?php echo $jumlah ?? ''; ?>" class="form-control" required>
                                                                <br>
                                                                <select name="idpelatih" class="form-control" required>
                                                                <?php
                                                                $query = "SELECT * FROM pelatih INNER JOIN personaltrainer ON pelatih.idpersonaltrainer = personaltrainer.idpersonaltrainer";
                                                                $result = mysqli_query($conn, $query);

                                                                while ($row = mysqli_fetch_assoc($result)) {
                                                                    $idpelatih = $row['idpelatih'];
                                                                    $namapelatih = $row['namapelatih'];
                                                                    $idpersonaltrainer = $row['idpersonaltrainer'];
                                                                    $program = $row['program'];
                                                                    $status_program = $row['status'];

                                                                    echo "<option value=\"$idpelatih\">$namapelatih ($program $status_program)</option>";
                                                                }
                                                                ?>
                                                                </select>
                                                                <br>
                                                                <button type="submit" class="btn btn-primary" name="updatecustomer">Submit</button>
                                                            </div>
                                                        </form>

                                                    </div>
                                                </div>
                                            </div>
                                            <?php
                                            ?>
                                            <!-- Modal untuk Delete -->
                                            <div class="modal" id="delete<?php echo $idc; ?>">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">

                                                        <!-- Modal Header -->
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">Hapus Pelanggan</h4>
                                                            <button type="button" class="close" data-dismiss="modal"></button>
                                                        </div>

                                                        <!-- Modal body -->
                                                        <form method="post">
                                                            <div class="modal-body">
                                                                Apakah Anda yakin ingin menghapus pelanggan ini?
                                                                <!-- Perbaikan: Tambahkan input hidden untuk 'idcustomer' -->
                                                                <input type="hidden" name="idcustomer" value="<?php echo $idc; ?>">
                                                                <br><br>
                                                                <button type="submit" class="btn btn-danger" name="hapuscustomer">Hapus</button>
                                                            </div>
                                                        </form>
                                                    </div>
                                                </div>
                                            </div>

                                            <?php
                                            }
                                            ?>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous"></script>
        <script src="js/scripts.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/chart-area-demo.js"></script>
        <script src="assets/demo/chart-bar-demo.js"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
        <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
        <script src="assets/demo/datatables-demo.js"></script>
    </body>

      <!-- The Modal -->
      <div class="modal" id="myModal">
        <div class="modal-dialog">
        <div class="modal-content">

             <!-- Modal Header -->
            <div class="modal-header">
            <h4 class="modal-title">Tambah Pelanggan</h4>
            <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>

            <!-- Modal body -->
             <form method="post">
            <div class="modal-body">
            <input type="text" name="pelanggan" placeholder="Nama Pelanggan"class="form-control"required>
            <br>
            <input type="text" name="nohp" placeholder="No HP"class="form-control"required>
            <br>
            <input type="text" name="alamat" placeholder="Alamat"class="form-control"required>
            <br>
            <select name="periodenya" class="form-control">
                <?php
                    $tulisperiodenya = mysqli_query($conn, "select * from periode");
                    while($fetcharray = mysqli_fetch_array($tulisperiodenya)) {
                    $idperiode = $fetcharray['idperiode'];
                    $periode = $fetcharray['periode'];

                ?>
            <option value="<?= $idperiode; ?>"><?= $periode; ?></option>
            <?php
             }
            ?>
            </select>
            <br>

            <input type="text" name="jumlah" placeholder="Jumlah"class="form-control"required>
            <br>
            <select name="pelatihnya" class="form-control"required>
            <?php
            $query = "SELECT * FROM pelatih INNER JOIN personaltrainer ON pelatih.idpersonaltrainer = personaltrainer.idpersonaltrainer";

            $result = mysqli_query($conn, $query);

            // Loop untuk menampilkan hasil INNER JOIN
            while ($row = mysqli_fetch_assoc($result)) {
            $idpelatih = $row['idpelatih'];
            $namapelatih = $row['namapelatih'];
            $idpersonaltrainer = $row['idpersonaltrainer'];
            $program = $row ['program'];
            $status_program = $row['status'];
                
            echo "<option value=\"$idpelatih\">$namapelatih ($program$status_prgoram)</option>";
            }

            // Tutup koneksi
            mysqli_close($conn);
            ?>
            </select>
        <br>
        <button type="submit" class="btn btn-primary" name="addnewcustomer">submit</button>
        </div>
        <br>
        </div>
        </div>
    </div>
</html>



backup function.php
<?php 
//membuat koneksi ke database
$conn= mysqli_connect ("localhost","root","","gym");




//menambah nama karyawan
if(isset($_POST['addnewkaryawan'])){
    $idkaryawan=$_POST['idkaryawan'];
    $namakaryawan=$_POST['namakaryawan'];

    $addtotable = mysqli_query($conn,"insert into karyawan (idkaryawan,namakaryawan)values('$idkaryawan','$namakaryawan')");
    if($addtotable){
        header('location:karyawan.php');

    }else{
        echo 'Gagal';
        header('location:karyawan.php');
    }
}


//Edit Karyawan
if (isset($_POST['updatekaryawan'])) {
    $idkaryawan = $_POST['idkaryawan'];
    $namakaryawan = $_POST['namakaryawan'];

    updatekaryawan($conn, $idkaryawan,$namakaryawan);
}

function updatekaryawan($conn, $idkaryawan,$namakaryawan) {
    $query = "UPDATE karyawan SET namakaryawan='$namakaryawan' WHERE idkaryawan='$idkaryawan'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location: karyawan.php');
        exit();
    } else {
        echo 'Gagal';
        header('location:karyawan.php'); 
    }
}


// Delete Karyawan
if (isset($_POST['hapuskaryawan'])) {

    $idkaryawan = $_POST['idkaryawan'];

    deleteKaryawan($conn, $idkaryawan);
}

function deleteKaryawan($conn, $idkaryawan) {
    $query = "DELETE FROM karyawan WHERE idkaryawan='$idkaryawan'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location:karyawan.php');
    } else {
        echo 'Gagal';
        header('Location:karyawan.php');
    }
}




//menambah pelatih
if(isset($_POST['addnewpelatih'])){
    $idpelatih=$_POST['idpelatih'];
    $namapelatih=$_POST['namapelatih'];
    $idpersonaltrainernya=$_POST ['idpersonaltrainernya'];

    $addtopelatih = mysqli_query($conn,"INSERT INTO pelatih (idpelatih,namapelatih,idpersonaltrainer)values('$idpelatih','$namapelatih','$idpersonaltrainernya')");
    if($addtopelatih){
        header('location:pelatih.php');

    }else{
        echo 'Gagal';
        header('location:pelatih.php');
    }
}

//Edit Pelatih
if (isset($_POST['updatepelatih'])) {
    $idp = $_POST['idpelatih'];
    $namapelatih = $_POST['namapelatih'];
    $idpersonaltrainer = $_POST['idpersonaltrainer'];

    updatepelatih($conn, $idp, $namapelatih, $idpersonaltrainer);
}

function updatepelatih($conn, $idpelatih, $namapelatih, $idpersonaltrainer) {
    $query = "UPDATE pelatih SET namapelatih='$namapelatih', idpersonaltrainer='$idpersonaltrainer' WHERE idpelatih='$idpelatih'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location:pelatih.php');
    } else {
        echo 'Gagal';
        header('location:pelatih.php');
    }
}


// Delete Pelatih
if (isset($_POST['hapuspelatih'])) {

    $idpelatih = $_POST['idpelatih'];

    deletePelatih($conn, $idpelatih);
}

function deletePelatih($conn, $idpelatih) {
    $query = "DELETE FROM pelatih WHERE idpelatih='$idpelatih'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location:pelatih.php');
    } else {
        echo 'Gagal';
        header('Location:pelatih.php');
    }
}




if(isset($_POST['addnewcustomer'])){
    $pelanggan = $_POST['pelanggan'];
    $nohp = $_POST['nohp'];
    $alamat = $_POST['alamat'];
    $periodenya = $_POST['periodenya'];
    $jumlah = $_POST['jumlah'];
    $pelatihnya = $_POST['pelatihnya']; // Ini tetap ID pelatih

    // Mendapatkan data pelatih berdasarkan ID
    $result = mysqli_query($conn, "SELECT namapelatih, idpersonaltrainer FROM pelatih WHERE idpelatih = '$pelatihnya'");
    $row = mysqli_fetch_assoc($result);
    $namapelatih = $row['namapelatih'];
    $idpersonaltrainer = $row['idpersonaltrainer'];
    $gabunganPelatih = $namapelatih . ' (' . $idpersonaltrainer . ')';

    // Jika $idcustomer adalah AUTO_INCREMENT, tidak perlu menyertakannya di sini
    $addtocustomer = mysqli_query($conn, "INSERT INTO customer (pelanggan, nohp, alamat, idperiode, jumlah, idpelatih) VALUES ('$pelanggan', '$nohp', '$alamat', '$periodenya', '$jumlah', '$pelatihnya')");
    
    if($addtocustomer){
        header('Location: customer.php');
    } else {
        echo 'Gagal';
        header('Location: customer.php');
    }
}


if (isset($_POST['updatecustomer'])) {
    $idcustomer = $_POST['idcustomer'];
    $pelanggan = $_POST['pelanggan'];
    $nohp = $_POST['nohp'];
    $alamat = $_POST['alamat'];
    $idperiode = $_POST['idperiode'];
    $jumlah = $_POST['jumlah'];
    $idpelatih = $_POST['idpelatih'];
    $price = $_POST['price'];

    viewtransaksi($conn, $idcustomer, $pelanggan, $nohp, $alamat, $idperiode, $jumlah, $idpelatih, $price);
}

function viewtransaksi($conn, $idcustomer, $pelanggan, $nohp, $alamat, $idperiode, $jumlah, $idpelatih, $price) {
    $query = "UPDATE customer SET pelanggan='$pelanggan', nohp='$nohp', alamat='$alamat', idperiode='$idperiode', jumlah='$jumlah', idpelatih='$idpelatih', price='$price' WHERE idcustomer='$idcustomer'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location: customer.php');
        exit();
    } else {
        echo 'Gagal';
        header('Location: customer.php');
        exit(); 
    }
}


// Delete Customer
if (isset($_POST['hapuscustomer'])) {

    $idcustomer = $_POST['idcustomer'];

    deleteCustomer($conn, $idcustomer);
}

function deleteCustomer($conn, $idcustomer) {
    $query = "DELETE FROM customer WHERE idcustomer='$idcustomer'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location:customer.php');
    } else {
        echo 'Gagal';
        header('Location:customer.php');
    }
}


//menambah transaksi
if(isset($_POST['addnewtransaksi'])){
    $customernya=$_POST['customernya'];
    $karyawannya=$_POST['karyawannya'];

    $addtotransaksi = mysqli_query($conn, "INSERT INTO transaksi (idcustomer, idkaryawan) VALUES ('$customernya', '$karyawannya')");
    if ($addtotransaksi) {
        header('location: index.php');
    } else {
        echo 'Gagal';
        header('location: index.php');
    }
}    

// Delete Transaksi
if (isset($_POST['hapustransaksi'])) {

    $idi = $_POST['id_invoice'];

    deleteTransaksi($conn, $idi);
}

function deleteTransaksi($conn, $idi) {
    $query = "DELETE FROM transaksi WHERE id_invoice='$idi'";
    $result = mysqli_query($conn, $query);
    if ($result) {
        header('Location:index.php');
    } else {
        echo 'Gagal';
        header('Location:index.php');
    }
}


//Menambah Personal Trainer
if(isset($_POST['addnewpersonaltrainer'])){
    $idpersonaltrainer=$_POST['idpersonaltrainer'];
    $program=$_POST['program'];

    $addtopersonaltrainer = mysqli_query($conn, "insert into personaltrainer(idpersonaltrainer,program)values('$idpersonaltrainer','$program')");
    if($addtopersonaltrainer){
        header('location:personaltrainer.php');

    }else{
        echo 'Gagal';
        header('location:personaltrainer.php');
    }
}


?>


